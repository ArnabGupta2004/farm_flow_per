/* Teddy Factory Run - Dark Industrial Theme */
body {
    background-color: #000000;
    /* Requested Black Background */
    margin: 0;
    overflow: hidden;
    font-family: 'Love Ya Like A Sister', cursive;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.game-wrapper {
    text-align: center;
    width: 100%;
}

.game-title {
    font-family: 'Emilys Candy', cursive;
    font-size: 3rem;
    margin-bottom: 20px;
    color: #ff9ff3;
    text-shadow: 0 0 10px rgba(255, 159, 243, 0.5);
}

#game-container {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    /* Removed border, background, shadow for transparent look */
}

/* --- Layers --- */

#factory-bg {
    position: absolute;
    top: 18%;
    left: 18%;
    width: 68.5%;
    height: 68.5%;
    background-image: url('assets/factory.png');
    /* Updated to factory.png */
    background-size: 1024px auto;
    /* Fixed width to match image dimensions for seamless loop */
    background-repeat: repeat-x;
    z-index: 1;

    /* Animation: Right to Left Scroll - Paused initially */
    animation: scrollBg 20s linear infinite;
    /* Half the speed of belt (20s vs 10s) for parallax effect */
    animation-play-state: paused;
}

/* Start animation when game begins */
#factory-bg.playing {
    animation-play-state: running;
}

@keyframes scrollBg {
    from {
        background-position: 0 0;
    }

    to {
        background-position: -1024px 0;
        /* Negative value for right-to-left scrolling */
    }
}

/* ... existing element styles ... */

#begin-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #ff7675;
    color: white;
    border: none;
    padding: 20px 50px;
    font-size: 2rem;
    font-family: inherit;
    border-radius: 50px;
    cursor: pointer;
    z-index: 100;
    /* Topmost */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s;
}

#begin-btn:hover {
    transform: translate(-50%, -50%) scale(1.1);
    background: #ff5252;
}

#conveyor-belt {
    position: absolute;
    bottom: 13%;
    left: 0;
    width: 100%;
    height: 100px;
    background-image: url('assets/belt.png');
    background-size: 1333px 100px;
    /* Scaled to maintain aspect ratio: 1919x144 -> 1333x100 */
    background-repeat: repeat-x;
    z-index: 15;
    /* Above factory (1) and teddy (10), below foreground (20) */

    /* Animation: Left to Right Scroll (opposite of factory) - Paused initially */
    animation: scrollBelt 6.67s linear infinite;
    animation-play-state: paused;
}

/* Start animation when game begins */
#conveyor-belt.playing {
    animation-play-state: running;
}

@keyframes scrollBelt {
    from {
        background-position: 0 0;
    }

    to {
        background-position: -1333px 0;
        /* Move exactly one tile width for seamless loop */
    }
}

#teddy {
    position: absolute;
    bottom: 170px;
    left: 30%;
    width: 124px;
    /* Resized from 200px to match aspect ratio (264x427 -> ~124x200) */
    height: 200px;
    z-index: 17;
    /* Same z-level as belt */
    transition: transform 0.1s ease-out;
    /* Smoothly handle any state resets */
}

/* Sprite Container */
/* Sprite Container */
.teddy-sprite {
    width: 100%;
    height: 100%;
    background-image: url('assets/run_sheet.png');
    /* 
       Optimization: Force integer scaling to match container width (124px) exactly.
       Frame Width: 124px
       Frame Count: 19
       Total Width: 19 * 124 = 2356px.
       Height: 200px.
    */
    background-size: 2356px 200px;
    background-repeat: no-repeat;
    background-position: 0 0;
}

/* Run Animation */
#teddy.playing .teddy-sprite {
    animation: runCycle 0.6s steps(19) infinite;
}

@keyframes runCycle {
    from {
        background-position: 0 0;
    }

    to {
        background-position: -2356px 0;
    }
}

/* When playing, switch to animated GIF */


/* Jump animation */
#teddy.jumping {
    /* 1.2s total duration as requested */
    animation: jump 1.2s;
    transform-origin: bottom center;
    /* Ensure scaling happens from the feet */
}

@keyframes jump {
    0% {
        bottom: 170px;
        transform: scale(1, 1);
        /* Smooth deceleration up (Ease Out Quad) */
        animation-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    5% {
        /* Subtle Stretch Launch */
        transform: scale(0.95, 1.05);
    }

    50% {
        bottom: 370px;
        /* Peak height: 200px jump */
        transform: scale(1, 1);
        /* Smooth acceleration down (Ease In Quad) */
        animation-timing-function: cubic-bezier(0.55, 0.085, 0.68, 0.53);
    }

    95% {
        transform: scale(1, 1);
    }

    100% {
        bottom: 170px;
        /* Subtle Squash Landing */
        transform: scale(1.05, 0.95);
    }
}

#foreground {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('assets/front.png');
    background-size: cover;
    background-repeat: no-repeat;
    z-index: 20;
    pointer-events: none;
}

/* Obstacles */
.obstacle {
    position: absolute;
    bottom: 140px;
    /* Same as teddy */
    right: -100px;
    /* Start off-screen */
    width: 100px;
    height: 100px;
    background-image: url('assets/crate.png');
    background-size: contain;
    background-repeat: no-repeat;
    z-index: 16;
    /* Between belt (15) and teddy (17) */
    transition: opacity 1s ease-out;
    /* Enable fade out */
}

.obstacle.fade-out {
    opacity: 0;
}

/* Blast Effect */
.obstacle.blast {
    animation: blastAnim 0.4s ease-out forwards !important;
    background-image: url('assets/crate.png');
    /* Keep image but maybe tint? */
    filter: brightness(0) invert(1) sepia(100%) saturate(10000%) hue-rotate(0deg);
    /* Turn red/white? */
}

.obstacle.scissor.blast {
    background-image: url('assets/scissor.png');
}

@keyframes blastAnim {
    0% {
        transform: scale(1);
        opacity: 1;
    }

    100% {
        transform: scale(2.5);
        opacity: 0;
    }
}

/* Red Flash Overlay */
#game-container.flash-red::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 0, 0, 0.4);
    z-index: 999;
    animation: flashRedAnim 0.3s ease-out forwards;
    pointer-events: none;
}

@keyframes flashRedAnim {
    0% {
        opacity: 1;
    }

    100% {
        opacity: 0;
    }
}

.obstacle.scissor {
    bottom: 400px;
    /* High enough to walk under (Ted head is at 370px), hit if jumped */
    background-image: url('assets/scissor.png');
    width: 100px;
    /* Slightly wider */
    height: 60px;
}

/* Powerups */
.powerup {
    position: absolute;
    bottom: 200px;
    /* Floating slightly above ground */
    right: -100px;
    width: 60px;
    height: 60px;
    background-size: contain;
    background-repeat: no-repeat;
    z-index: 16;
    /* Same as obstacles (was 100) */
    /* Above obstacles */
    animation: floatPowerup 2s ease-in-out infinite;
}

.powerup.shield {
    background-image: url('assets/shield.png');
    width: 70px;
    height: 70px;
    filter: drop-shadow(0 0 8px #00a8ff);
}

@keyframes floatPowerup {

    0%,
    100% {
        transform: translateY(0);
    }

    50% {
        transform: translateY(-10px);
    }
}

/* Shielded State */
#teddy.shielded {
    filter: drop-shadow(0 0 10px #74b9ff) drop-shadow(0 0 20px #0984e3);
}

#teddy.shielded::after {
    content: '';
    position: absolute;
    top: -20px;
    left: -20px;
    right: -20px;
    bottom: -20px;
    border: 4px solid #74b9ff;
    border-radius: 50%;
    animation: shieldPulse 1.5s infinite alternate;
    box-shadow: 0 0 15px #74b9ff inset;
    opacity: 0.6;
    z-index: 20;
}

@keyframes shieldPulse {
    from {
        transform: scale(1);
        opacity: 0.6;
    }

    to {
        transform: scale(1.1);
        opacity: 0.3;
    }
}

/* Progress Bar */
#progress-container {
    position: absolute;
    top: 50px;
    left: 50%;
    transform: translateX(-50%);
    width: 300px;
    height: 8px;
    /* Thin line */
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    overflow: visible;
    /* Allow flag to show */
    z-index: 100;
    display: none;
    /* Hidden until game starts */
}

/* Destination Flag */
#progress-container::after {
    content: 'ðŸš©';
    position: absolute;
    right: -10px;
    /* Align at the end */
    top: 50%;
    transform: translate(100%, -50%);
    /* Move slightly right of the end */
    font-size: 24px;
    font-family: 'Noto Color Emoji', sans-serif;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
}

#progress-fill {
    width: 0%;
    height: 100%;
    background: #ff7675;
    /* Salmon pink */
    border-radius: 4px;
    box-shadow: 0 0 10px rgba(255, 118, 117, 0.8);
    /* Glow */
    transition: width 0.1s linear;
}

/* --- Loss Popup (Dark Theme - Restored) --- */
#game-over-popup {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.85);
    padding: 30px 60px;
    border-radius: 20px;
    text-align: center;
    border: 2px solid #ff7675;
    display: none;
    /* Hidden by default */
    z-index: 200;
}

#game-over-popup h2 {
    font-family: 'Emilys Candy', cursive;
    color: #ff7675;
    font-size: 3rem;
    margin: 0 0 20px 0;
}

#game-over-popup p {
    font-family: 'Love Ya Like A Sister', cursive;
    font-size: 1.2rem;
    color: white;
}

#restart-btn {
    background: #ff7675;
    color: white;
    border: none;
    padding: 15px 40px;
    font-size: 1.5rem;
    font-family: 'Love Ya Like A Sister', cursive;
    border-radius: 50px;
    cursor: pointer;
    transition: transform 0.2s, background 0.2s;
    margin-top: 20px;
}

#restart-btn:hover {
    transform: scale(1.1);
    background: #ff5252;
}

/* --- Win Popup (Propose Day Style - New) --- */
#win-popup.popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

#win-popup.show {
    opacity: 1;
    visibility: visible;
}

#win-popup .popup-container {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(255, 105, 180, 0.4);
    display: flex;
    max-width: 800px;
    width: 90%;
    overflow: hidden;
    transform: scale(0.8);
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    gap: 0px;
}

#win-popup.show .popup-container {
    transform: scale(1);
}

#win-popup .popup-left {
    width: 60%;
    padding: 50px 10px 50px 30px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
}

#win-popup .popup-title {
    font-family: 'Emilys Candy', cursive;
    font-size: 2.5em;
    color: #ff0000;
    margin: 0 0 20px 0;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(139, 0, 0, 0);
}

#win-popup .popup-message {
    font-family: 'Love Ya Like A Sister', cursive;
    font-size: 1.2em;
    color: #000000;
    line-height: 1.6;
    margin: 0 0 30px 0;
    text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3);
}

#win-popup .popup-right {
    width: 40%;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    padding: 0;
}

#win-popup .popup-character {
    width: 100%;
    height: auto;
    max-width: 300px;
    object-fit: contain;
    image-rendering: pixelated;
    filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3));
}

.calendar-button {
    font-family: 'Love Ya Like A Sister', cursive;
    font-size: 1.1em;
    background: #ff69b4;
    color: #fff;
    padding: 15px 40px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
    transition: all 0.3s ease;
    font-weight: bold;
}

.calendar-button:hover {
    background: #ff1493;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 105, 180, 0.6);
}

.calendar-button:active {
    transform: translateY(0);
}

/* --- Responsive Design --- */
@media (max-width: 768px) {
    #win-popup .popup-container {
        flex-direction: column;
        max-width: 90%;
    }

    #win-popup .popup-left {
        width: 100%;
        padding: 30px 25px;
        box-sizing: border-box;
    }

    #win-popup .popup-right {
        width: 100%;
        padding: 20px;
        justify-content: center;
        box-sizing: border-box;
    }

    #win-popup .popup-character {
        max-width: 200px;
    }
}

/* ---/* Cozy Pink Glow Overlay */
.cozy-glow::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 118, 117, 0.2) 0%, rgba(255, 118, 117, 0.5) 100%);
    pointer-events: none;
    z-index: 150;
    /* Above game elements, below popup */
    animation: glowPulse 3s infinite alternate;
}

@keyframes glowPulse {
    from {
        opacity: 0.5;
    }

    to {
        opacity: 1;
    }
}

/* --- Missing Animation Assets Restored --- */

/* Gift Element */
#gift {
    position: absolute;
    bottom: 160px;
    /* Same baseline as Teddy */
    right: -200px;
    /* Start off-screen */
    width: 120px;
    height: 120px;
    background-image: url('assets/gift.png');
    background-size: contain;
    background-repeat: no-repeat;
    z-index: 18;
    /* Slightly in front of Teddy */
    transition: right 6s cubic-bezier(0.25, 1, 0.5, 1);
    /* Elegant slide */
}

/* Floating Hearts */
.heart {
    position: absolute;
    width: 30px;
    height: 30px;
    background: url('hero-heart.png') no-repeat center/contain;
    /* Fallback or create SVG */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff7675'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
    z-index: 150;
    opacity: 0;
    animation: floatUp 2s ease-out forwards;
}

@keyframes floatUp {
    0% {
        transform: translateY(0) scale(0.5);
        opacity: 0;
    }

    10% {
        opacity: 1;
    }

    100% {
        transform: translateY(-200px) scale(1.5);
        opacity: 0;
    }
}

/* Pause animations on Game Over */
.paused {
    animation-play-state: paused !important;
}

/* ===== START SCREEN STYLES ===== */
#start-screen {
    gap: 20px;
    /* Vignette Effect */
    background: radial-gradient(circle at center, rgba(0, 0, 0, 0) 40%, rgba(0, 0, 0, 0.5) 100%), rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(8px);
    animation: fadeInOverlay 1s ease-out forwards;
}

@keyframes fadeInOverlay {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes fadeOutOverlay {
    from {
        opacity: 1;
    }

    to {
        opacity: 0;
    }
}

.screen-exit {
    animation: fadeOutOverlay 0.8s ease-out forwards !important;
}

/* Start Screen Animations */
@keyframes slideDownIn {
    from {
        transform: translateY(-100vh);
        opacity: 0;
    }

    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes slideUpIn {
    from {
        transform: translateY(100vh);
        opacity: 0;
    }

    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes slideUpOut {
    from {
        transform: translateY(0);
        opacity: 1;
    }

    to {
        transform: translateY(-100vh);
        opacity: 0;
    }
}

@keyframes slideDownOut {
    from {
        transform: translateY(0);
        opacity: 1;
    }

    to {
        transform: translateY(100vh);
        opacity: 0;
    }
}

.title-img {
    max-width: 80%;
    height: auto;
    /* animation: slideDownIn 1s cubic-bezier(0.25, 1, 0.5, 1) forwards; REMOVED for manual trigger */
    opacity: 0;
    /* Hidden initially */
}

.play-btn-img {
    width: 200px;
    height: auto;
    cursor: pointer;
    transition: transform 0.2s;
    /* animation: slideUpIn 1s cubic-bezier(0.25, 1, 0.5, 1) forwards; REMOVED for manual trigger */
    opacity: 0;
    /* Hidden initially */
}

.play-btn-img:hover {
    transform: scale(1.1);
}

@keyframes fadeOutOverlay {
    from {
        opacity: 1;
    }

    to {
        opacity: 0;
    }
}

.title-exit {
    animation: slideUpOut 0.8s cubic-bezier(0.5, 0, 0.75, 0) forwards !important;
}

.btn-exit {
    animation: slideDownOut 0.8s cubic-bezier(0.5, 0, 0.75, 0) forwards !important;
}

.screen-exit {
    animation: fadeOutOverlay 0.8s ease-out forwards !important;
}

/* Character Guide */
.character-guide {
    /* CONTROL VARIABLES START */
    --char-width: 300px;
    --char-height: auto;
    --char-bottom: -10px;
    --char-left: 0px;
    /* CONTROL VARIABLES END */

    position: fixed;
    bottom: var(--char-bottom);
    left: var(--char-left);
    width: var(--char-width);
    height: var(--char-height);
    z-index: 100;
    /* High z-index to stay on top */
    pointer-events: none;
    transition: opacity 1s ease, transform 1s ease;
}

.character-guide.hidden {
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
}

.character-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    image-rendering: pixelated;
    transform: scaleX(-1);
    /* Flip horizontally */
}

/* Text Bubble Image */
#text-bubble {
    /* CONTROL VARIABLES START */
    --bubble-img-width: 300px;
    --bubble-img-bottom: 380px;
    --bubble-img-left: 0px;
    /* CONTROL VARIABLES END */

    position: fixed;
    bottom: var(--bubble-img-bottom);
    left: var(--bubble-img-left);
    width: var(--bubble-img-width);
    height: auto;
    z-index: 102;
    /* Above character guide (100) */
    pointer-events: none;
    transition: opacity 0.5s ease, transform 0.5s ease;
    opacity: 1;
    transform: translateY(0);
}

#text-bubble.hidden {
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
}



/* --- Transition Overlay --- */
#transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 20000;
    background: #ffb7c5;
}

#transition-overlay img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.overlay-fall {
    animation: fallDownTransition 1.2s ease-in forwards;
}

@keyframes fallDownTransition {
    to {
        transform: translateY(100vh);
    }
}

/* --- Manual Triggers --- */
.anim-title-enter {
    animation: slideDownIn 1s cubic-bezier(0.25, 1, 0.5, 1) forwards;
}

.anim-btn-enter {
    animation: slideUpIn 1s cubic-bezier(0.25, 1, 0.5, 1) forwards;
}